<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kode Kata (with API)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow: hidden;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #4a6fa5;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .api-settings {
            background-color: #f5f7fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .api-settings h3 {
            margin-bottom: 10px;
            color: #4a6fa5;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .toggle-settings {
            color: #4a6fa5;
            text-decoration: underline;
            cursor: pointer;
            display: block;
            text-align: center;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            margin-bottom: 20px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
            outline: none;
        }

        .input-group input:focus {
            border-color: #4a6fa5;
        }

        .btn {
            background-color: #4a6fa5;
            color: white;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #3d5a88;
        }

        .btn.regenerate {
            border-radius: 5px;
            margin-top: 15px;
            display: none;
            background-color: #5e9a8e;
        }

        .btn.regenerate:hover {
            background-color: #4d8274;
        }

        .btn.api-save {
            border-radius: 5px;
            padding: 10px 15px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a6fa5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .result {
            display: none;
            padding: 20px;
            border-top: 1px solid #eee;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .error {
            color: #d9534f;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            background-color: #f9e4e4;
            display: none;
        }

        .word {
            font-size: 24px;
            color: #4a6fa5;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .sentence {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f7fa;
            border-radius: 5px;
            border-left: 4px solid #4a6fa5;
        }

        .gif-container {
            text-align: center;
            margin: 20px 0;
        }

        .gif-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .timestamp {
            color: #888;
            font-size: 14px;
            text-align: right;
            margin-top: 10px;
        }

        .api-type-selector {
            display: flex;
            margin-bottom: 15px;
        }

        .api-type-selector label {
            flex: 1;
            text-align: center;
            padding: 10px;
            background-color: #e9ecef;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .api-type-selector label:first-child {
            border-radius: 5px 0 0 5px;
        }

        .api-type-selector label:last-child {
            border-radius: 0 5px 5px 0;
        }

        .api-type-selector input[type="radio"] {
            display: none;
        }

        .api-type-selector input[type="radio"]:checked+label {
            background-color: #4a6fa5;
            color: white;
            border-color: #4a6fa5;
        }

        .api-group {
            display: none;
        }

        .api-group.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Aplikasi Kode Kata</h1>
            <p>Masukkan kode untuk melihat kalimat dan GIF sesuai dengan kata yang terhubung</p>
        </div>

        <a class="toggle-settings" id="toggleSettings">Konfigurasi API</a>

        <div class="api-settings" id="apiSettings" style="display: none;">
            <h3>Konfigurasi API</h3>

            <div class="api-type-selector">
                <input type="radio" id="openaiApi" name="apiType" value="openai" checked>
                <label for="openaiApi">OpenAI</label>

                <input type="radio" id="huggingfaceApi" name="apiType" value="huggingface">
                <label for="huggingfaceApi">Hugging Face</label>
            </div>

            <div class="api-group active" id="openaiGroup">
                <div class="form-group">
                    <label>OpenAI API Key:</label>
                    <input type="password" id="openaiApiKey" placeholder="sk-...">
                </div>
            </div>

            <div class="api-group" id="huggingfaceGroup">
                <div class="form-group">
                    <label>Hugging Face API Key:</label>
                    <input type="password" id="huggingfaceApiKey" placeholder="hf_...">
                </div>
            </div>

            <div class="form-group">
                <label>Tenor API Key (untuk GIF):</label>
                <input type="password" id="tenorApiKey" placeholder="API key Tenor">
            </div>

            <button class="btn api-save" id="saveApiSettings">Simpan Konfigurasi</button>
        </div>

        <div class="input-group">
            <input type="text" id="codeInput" placeholder="Masukkan kode..." maxlength="3">
            <button id="processBtn" class="btn">Proses</button>
        </div>

        <div class="error" id="errorMsg"></div>

        <div class="loading" id="loading"></div>

        <div class="result" id="result">
            <div class="word" id="wordDisplay"></div>
            <div class="sentence" id="sentenceDisplay"></div>

            <div class="gif-container">
                <img id="gifDisplay" src="" alt="GIF terkait">
            </div>

            <button id="regenerateBtn" class="btn regenerate">Generate Ulang</button>

            <div class="timestamp" id="timestampDisplay"></div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Mapping dari kode ke kata
            const codeToWord={
                '001': 'bahagia',
                '002': 'sedih',
                '003': 'cinta',
                '004': 'marah',
                '005': 'takut',
                '006': 'damai',
                '007': 'harapan',
                '008': 'mimpi',
                '009': 'keluarga',
                '010': 'teman'
                // Tambahkan kode lainnya hingga 100
            };

            // Toggle API settings
            $('#toggleSettings').click(function() {
                $('#apiSettings').slideToggle();
            });

            // Toggle between API types
            $('input[name="apiType"]').change(function() {
                $('.api-group').removeClass('active');
                if($(this).val()==='openai') {
                    $('#openaiGroup').addClass('active');
                } else {
                    $('#huggingfaceGroup').addClass('active');
                }
            });

            // Save API settings
            $('#saveApiSettings').click(function() {
                const apiType=$('input[name="apiType"]:checked').val();
                let aiApiKey='';

                if(apiType==='openai') {
                    aiApiKey=$('#openaiApiKey').val();
                } else {
                    aiApiKey=$('#huggingfaceApiKey').val();
                }

                const tenorApiKey=$('#tenorApiKey').val();

                // Save to localStorage
                localStorage.setItem('kodeKata_apiType',apiType);
                localStorage.setItem('kodeKata_aiApiKey',aiApiKey);
                localStorage.setItem('kodeKata_tenorApiKey',tenorApiKey);

                $('#apiSettings').slideUp();
                showMessage('Konfigurasi API berhasil disimpan!');
            });

            // Load saved API settings
            const savedApiType=localStorage.getItem('kodeKata_apiType');
            const savedAiApiKey=localStorage.getItem('kodeKata_aiApiKey');
            const savedTenorApiKey=localStorage.getItem('kodeKata_tenorApiKey');

            if(savedApiType) {
                $(`input[name="apiType"][value="${savedApiType}"]`).prop('checked',true).trigger('change');
            }

            if(savedAiApiKey) {
                if(savedApiType==='openai') {
                    $('#openaiApiKey').val(savedAiApiKey);
                } else {
                    $('#huggingfaceApiKey').val(savedAiApiKey);
                }
            }

            if(savedTenorApiKey) {
                $('#tenorApiKey').val(savedTenorApiKey);
            }

            // Helper function to display temporary messages
            function showMessage(message) {
                const $msg=$('<div>')
                    .css({
                        position: 'fixed',
                        top: '20px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        padding: '10px 20px',
                        backgroundColor: '#4a6fa5',
                        color: 'white',
                        borderRadius: '5px',
                        boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                        zIndex: 1000
                    })
                    .text(message)
                    .appendTo('body');

                setTimeout(() => {
                    $msg.fadeOut(500,function() {
                        $(this).remove();
                    });
                },3000);
            }

            // Fungsi untuk menyimpan hasil ke localStorage
            function saveResult(code,result) {
                localStorage.setItem(`codeResult_${code}`,JSON.stringify(result));
            }

            // Fungsi untuk mendapatkan hasil dari localStorage
            function getStoredResult(code) {
                const stored=localStorage.getItem(`codeResult_${code}`);
                return stored? JSON.parse(stored):null;
            }

            // Fungsi untuk mendapatkan kalimat dari API AI
            async function getAIResponse(word) {
                try {
                    const apiType=localStorage.getItem('kodeKata_apiType')||'openai';
                    const apiKey=localStorage.getItem('kodeKata_aiApiKey');

                    if(!apiKey) {
                        throw new Error('API key tidak ditemukan. Silakan konfigurasi API terlebih dahulu.');
                    }

                    if(apiType==='openai') {
                        // OpenAI API
                        const response=await $.ajax({
                            url: 'https://api.openai.com/v1/completions',
                            type: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKey}`
                            },
                            data: JSON.stringify({
                                model: "gpt-3.5-turbo-instruct",
                                prompt: `Buatlah sebuah kalimat reflektif atau inspiratif tentang "${word}" dalam bahasa Indonesia (maksimal 150 karakter).`,
                                max_tokens: 60,
                                temperature: 0.7
                            })
                        });

                        return response.choices[0].text.trim();
                    } else {
                        // Hugging Face API
                        const response=await $.ajax({
                            url: 'https://api-inference.huggingface.co/models/gpt2',
                            type: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKey}`
                            },
                            data: JSON.stringify({
                                inputs: `Kata "${word}" mengingatkan kita bahwa`,
                                parameters: {
                                    max_length: 50,
                                    temperature: 0.7
                                }
                            })
                        });

                        // Hugging Face response
                        return response[0].generated_text;
                    }
                } catch(error) {
                    console.error('Error getting AI response:',error);
                    // Fallback ke kalimat default jika API gagal
                    return `Kata "${word}" mengajarkan kita untuk selalu menghargai setiap momen dalam hidup.`;
                }
            }

            // Fungsi untuk mendapatkan GIF dari API Tenor
            async function getGif(word) {
                try {
                    const apiKey=localStorage.getItem('kodeKata_tenorApiKey');

                    if(!apiKey) {
                        throw new Error('Tenor API key tidak ditemukan. Silakan konfigurasi API terlebih dahulu.');
                    }

                    const response=await $.ajax({
                        url: `https://tenor.googleapis.com/v2/search?q=${word}&key=${apiKey}&limit=10&random=true`,
                        type: 'GET'
                    });

                    if(response.results&&response.results.length>0) {
                        // Ambil GIF secara random dari hasil
                        const randomIndex=Math.floor(Math.random()*response.results.length);
                        return response.results[randomIndex].media_formats.gif.url;
                    }

                    throw new Error('Tidak ada GIF yang ditemukan');
                } catch(error) {
                    console.error('Error getting GIF:',error);

                    // Fallback GIFs
                    const fallbackGifs={
                        'bahagia': 'https://media.tenor.com/nYRoTuJpNxYAAAAd/happy-dance.gif',
                        'sedih': 'https://media.tenor.com/Z4OJwIDh8KYAAAAC/sad-faces.gif',
                        'cinta': 'https://media.tenor.com/FJe6dxwMy6YAAAAC/heart-love.gif',
                        'marah': 'https://media.tenor.com/PfFDd3eNE_gAAAAd/angry-mad.gif',
                        'takut': 'https://media.tenor.com/7mZGvzGW0vQAAAAC/anime-scared.gif',
                        'damai': 'https://media.tenor.com/vURWvfEOJswAAAAC/peaceful-place-nature.gif',
                        'harapan': 'https://media.tenor.com/zKmLnRCbiXcAAAAC/howtroubleshoot-hope.gif',
                        'mimpi': 'https://media.tenor.com/VXc31Mwdc_QAAAAC/stars-color.gif',
                        'keluarga': 'https://media.tenor.com/9MtIm1SBgfcAAAAC/family-love.gif',
                        'teman': 'https://media.tenor.com/H9lDlFucq3wAAAAC/friendship-friends.gif'
                    };

                    return fallbackGifs[word]||'https://media.tenor.com/xTiN0L7EW5trfOvEk0/giphy.gif';
                }
            }

            // Fungsi untuk memproses kode
            async function processCode(code) {
                // Hapus error sebelumnya
                $('#errorMsg').hide();

                // Validasi kode
                if(!code) {
                    showError('Silakan masukkan kode');
                    return;
                }

                // Cek apakah kode valid
                const word=codeToWord[code];
                if(!word) {
                    showError('Kode tidak valid');
                    return;
                }

                // Tampilkan loading
                $('#loading').show();
                $('#result').hide();

                try {
                    // Cek apakah hasil sudah tersimpan
                    const storedResult=getStoredResult(code);

                    if(storedResult) {
                        // Tampilkan hasil yang tersimpan
                        displayResult(storedResult);
                    } else {
                        // Dapatkan kalimat dan GIF baru
                        const sentence=await getAIResponse(word);
                        const gifUrl=await getGif(word);

                        const result={
                            code: code,
                            word: word,
                            sentence: sentence,
                            gifUrl: gifUrl,
                            timestamp: new Date().toISOString()
                        };

                        // Simpan hasil
                        saveResult(code,result);

                        // Tampilkan hasil
                        displayResult(result);
                    }
                } catch(error) {
                    console.error('Error:',error);
                    showError('Terjadi kesalahan. Silakan coba lagi.');
                } finally {
                    $('#loading').hide();
                }
            }

            // Fungsi untuk menampilkan error
            function showError(message) {
                $('#errorMsg').text(message).show();
            }

            // Fungsi untuk menampilkan hasil
            function displayResult(result) {
                $('#wordDisplay').text(`Kata: ${result.word}`);
                $('#sentenceDisplay').text(result.sentence);
                $('#gifDisplay').attr('src',result.gifUrl);

                const date=new Date(result.timestamp);
                $('#timestampDisplay').text(`Terakhir diupdate: ${date.toLocaleString()}`);

                $('#result').show();
                $('#regenerateBtn').show();
            }

            // Fungsi untuk generate ulang
            async function regenerate() {
                // Dapatkan kode saat ini
                const code=$('#codeInput').val();

                // Validasi kode
                if(!code) {
                    showError('Kode tidak valid');
                    return;
                }

                // Cek apakah kode valid
                const word=codeToWord[code];
                if(!word) {
                    showError('Kode tidak valid');
                    return;
                }

                // Tampilkan loading
                $('#loading').show();
                $('#result').hide();

                try {
                    // Dapatkan kalimat dan GIF baru
                    const sentence=await getAIResponse(word);
                    const gifUrl=await getGif(word);

                    const result={
                        code: code,
                        word: word,
                        sentence: sentence,
                        gifUrl: gifUrl,
                        timestamp: new Date().toISOString()
                    };

                    // Simpan hasil baru
                    saveResult(code,result);

                    // Tampilkan hasil
                    displayResult(result);
                } catch(error) {
                    console.error('Error:',error);
                    showError('Terjadi kesalahan. Silakan coba lagi.');
                } finally {
                    $('#loading').hide();
                }
            }

            // Event handler untuk tombol proses
            $('#processBtn').click(function() {
                const code=$('#codeInput').val();
                processCode(code);
            });

            // Event handler untuk input field (enter key)
            $('#codeInput').keypress(function(e) {
                if(e.which===13) {
                    const code=$(this).val();
                    processCode(code);
                }
            });

            // Event handler untuk tombol generate ulang
            $('#regenerateBtn').click(function() {
                regenerate();
            });
        });
    </script>
</body>

</html>